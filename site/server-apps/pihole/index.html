<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><link rel="canonical" href="https://example.com/server-apps/pihole/" />
      <link rel="shortcut icon" href="../../img/favicon.ico" />
    <title>Pihole - MacServer Documentation</title>
    <link rel="stylesheet" href="../../css/theme.css" />
    <link rel="stylesheet" href="../../css/theme_extra.css" />
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.5.0/styles/github.min.css" />
    
      <script>
        // Current page data
        var mkdocs_page_name = "Pihole";
        var mkdocs_page_input_path = "server-apps/pihole.md";
        var mkdocs_page_url = "/server-apps/pihole/";
      </script>
    
    <script src="../../js/jquery-3.6.0.min.js" defer></script>
    <!--[if lt IE 9]>
      <script src="../../js/html5shiv.min.js"></script>
    <![endif]-->
      <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.5.0/highlight.min.js"></script>
      <script>hljs.initHighlightingOnLoad();</script> 
</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
    <div class="wy-side-scroll">
      <div class="wy-side-nav-search">
          <a href="../.." class="icon icon-home"> MacServer Documentation
        </a><div role="search">
  <form id ="rtd-search-form" class="wy-form" action="../../search.html" method="get">
      <input type="text" name="q" placeholder="Search docs" title="Type search term here" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../..">Home</a>
                </li>
              </ul>
              <p class="caption"><span class="caption-text">First Time Setup</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../../first-time-setup/first-time-setup/">First Time Setup</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../first-time-setup/macos-settings/">macOS Settings</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">Server Apps</span></p>
              <ul class="current">
                  <li class="toctree-l1"><a class="reference internal" href="../macos-server/">macOS Server</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../teamviewer/">TeamViewer</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../jellyfin/">Jellyfin</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../homebridge/">Homebridge</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../scrypted/">Scrypted</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../node-red/">Node-RED</a>
                  </li>
                  <li class="toctree-l1 current"><a class="reference internal current" href="./">Pihole</a>
    <ul class="current">
    <li class="toctree-l2"><a class="reference internal" href="#setup">Setup</a>
        <ul>
    <li class="toctree-l3"><a class="reference internal" href="#create-a-virtualbox-vm">Create a Virtualbox VM</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#add-iso-as-a-boot-medium">Add ISO as a boot medium</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#install-ubuntu-server-with-default-settings-pihole-user-password-pihole">Install Ubuntu Server with default settings, pihole user, password pihole</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#configure-a-static-ip-for-the-vm">Configure a Static IP for the VM</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#install-pihole">Install PiHole</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#set-dhcp-server">Set DHCP Server</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#set-the-vm-to-auto-login">Set the VM to auto-login</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#set-the-vm-to-auto-launch-in-headless-mode-on-mac-login">Set the VM to auto-launch in headless mode on Mac login</a>
    </li>
        </ul>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#troubleshooting-sites-not-loading">Troubleshooting Sites not Loading</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#updating-pihole">Updating Pihole</a>
        <ul>
    <li class="toctree-l3"><a class="reference internal" href="#via-ssh">Via SSH:</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#via-apple-remote-desktop">Via Apple Remote Desktop</a>
    </li>
        </ul>
    </li>
    </ul>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">Troubleshooting</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../../troubleshooting/reboot/">Reboot</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../troubleshooting/live-tv-data-issues/">Live TV Guide Data Issues</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../troubleshooting/no-response-homekit/">Smart Devices showing as “No Response”/Orange Exclamation mark</a>
                  </li>
              </ul>
      </div>
    </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">
      <nav class="wy-nav-top" role="navigation" aria-label="Mobile navigation menu">
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../..">MacServer Documentation</a>
        
      </nav>
      <div class="wy-nav-content">
        <div class="rst-content"><div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="../.." class="icon icon-home" alt="Docs"></a> &raquo;</li>
          <li>Server Apps &raquo;</li><li>Pihole</li>
    <li class="wy-breadcrumbs-aside">
    </li>
  </ul>
  <hr/>
</div>

          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
            <div class="section" itemprop="articleBody">
              
                <h1 id="pihole">Pihole</h1>
<p>Pihole is used as a network wide Ad blocker using DNS.</p>
<h2 id="setup">Setup</h2>
<h3 id="create-a-virtualbox-vm">Create a Virtualbox VM</h3>
<p>(these are purposefully low-powered settings, it’s designed for a Raspberry Pi, so a powerful VM is not needed)</p>
<ul>
<li>1 GB memory</li>
<li>10 GB storage</li>
<li>bridged network</li>
<li>50% CPU Execution cap</li>
</ul>
<h3 id="add-iso-as-a-boot-medium">Add ISO as a boot medium</h3>
<p>Download ISO of LTS edition from <a href="https://ubuntu.com/download/server">https://ubuntu.com/download/server</a></p>
<ul>
<li>Settings of VM -&gt; Storage</li>
<li>Controller: IDE -&gt; Empty</li>
<li>Click the circle CD icon and pick ‘choose a disk file…’</li>
<li>Pick the downloaded ISO</li>
<li>Click OK</li>
<li>Start VM in headless mode (click arrow next to start -&gt; headless mode)</li>
</ul>
<h3 id="install-ubuntu-server-with-default-settings-pihole-user-password-pihole">Install Ubuntu Server with default settings, pihole user, password pihole</h3>
<ul>
<li>When asked for the network settings, take note of the MAC address and add a IP reservation to modem settings</li>
<li>After applying assigned IP, reset the VM and restart setup. This will force the VM to get a static IP. If this doesn't work, continue with setup, and do “configure a static IP for VM'' setup below</li>
</ul>
<h3 id="configure-a-static-ip-for-the-vm">Configure a Static IP for the VM</h3>
<p>Set static IP on Modem via MAC address
(MAC address listed under <code>$[ip addr]</code>)</p>
<p>RUN in terminal of PiHole VM:</p>
<ul>
<li><code>sudo nano /etc/netplan/00-installer-config.yaml</code></li>
<li>Copy these contents into the file that is generated, change IP address as needed                                      </li>
</ul>
<pre><code># This is the network config written by 'subiquity'
network:
  version: 2
  ethernets:
    enp0s3:
      addresses:
        - **IP ADDRESS SET ON MODEM**/24
      gateway4: 10.0.1.1
      nameservers:
        addresses:
          - 10.0.1.53
          - 8.8.4.4
</code></pre>
<ul>
<li><code>sudo netplan generate</code></li>
<li><code>sudo netplan apply</code></li>
<li><code>reboot</code></li>
</ul>
<h3 id="install-pihole">Install PiHole</h3>
<p>Follow directions from <a href="https://github.com/pi-hole/pi-hole/#curl--ssl-httpsinstallpi-holenet--bash">https://github.com/pi-hole/pi-hole/#curl--ssl-httpsinstallpi-holenet--bash</a></p>
<h3 id="set-dhcp-server">Set DHCP Server</h3>
<p>Set the IP address of the VM as the DHCP server in: modem settings <a href="192.168.0.1/">192.168.0.1</a> -&gt; Advanced Setup -&gt; DHCP Settings -&gt; Set the DNS servers allocated with DHCP requests. -&gt; Custom Servers -&gt; enter VM ip address as server 1, and Open DNS backup server (8.8.4.4) as server 2</p>
<h3 id="set-the-vm-to-auto-login">Set the VM to auto-login</h3>
<p><a href="https://askubuntu.com/a/819154">https://askubuntu.com/a/819154</a></p>
<p>RUN in terminal of PiHole VM:</p>
<ul>
<li><code>sudo systemctl edit getty@tty1.service</code></li>
</ul>
<p>Edit the file that is generated with these contents, change username to username of VM user (<code>pihole</code> in this case):</p>
<pre><code>[Service]
ExecStart=
ExecStart=-/sbin/agetty --noissue --autologin pihole %I $TERM
Type=idle
</code></pre>
<ul>
<li>Save with CTRL + X</li>
<li>Reboot machine and see if it auto-logs in as Pihole user</li>
</ul>
<h3 id="set-the-vm-to-auto-launch-in-headless-mode-on-mac-login">Set the VM to auto-launch in headless mode on Mac login</h3>
<ul>
<li>Download the script vboxlaunchagent.sh from 
<a href="https://www.whatroute.net/software/vboxlaunchagent.sh.zip">https://www.whatroute.net/software/vboxlaunchagent.sh.zip</a></li>
</ul>
<p>Directions from this website:</p>
<blockquote>
<p>LaunchAgents are configured with an Apple plist XML file installed in the users Library/LaunchAgents folder. When the user logs in to their account on the Mac, launchd will inspect these plist files and invoke the required program with specified arguments.</p>
<p>It can get a bit tricky to create a plist manually. They have very fussy and very unforgiving syntax requirements. This shell script will create the plist and install it in the LaunchAgents directory.</p>
<p>You can download the script from vboxlaunchagent.sh. Unzip the file and copy the script to a suitable directory on your machine.</p>
</blockquote>
<p>Run the script using this syntax:</p>
<p>Find the name of the VM: In a terminal on macOS, run: <code>VBoxManage list vms</code>
Should result in output similar to:  </p>
<pre><code>macmini@macserver ~ % VBoxManage list vms
&quot;Pihole&quot; {c7ac734f-3fc7-4645-997b-3c78ef32d8f4}
</code></pre>
<p>In this example, Pihole is the name of the VM.</p>
<p>In a terminal, run <code>sh vboxlaunchagent.sh --headless --verbose "VMName"</code>, replacing ‘VMName’ with the name of the VM from the previous step</p>
<p>Reboot the Mac and ensure the VM auto-starts on login</p>
<h2 id="troubleshooting-sites-not-loading">Troubleshooting Sites not Loading</h2>
<p>Pihole is a tracking and ad-blocker. Because of this, some sites may not load, or be missing content. </p>
<h2 id="updating-pihole">Updating Pihole</h2>
<p>If you see red text at the bottom of the PiHole web UI ‘Update Available’, it needs an update. This is currently a manual process, work in progress to automate it. There are two options, both do exactly the same thing. The SSH option may be easier. </p>
<h3 id="via-ssh">Via SSH:</h3>
<ol>
<li>Open a Terminal and enter command: <code>ssh pihole@pi.hole</code><br />
If you get a message similar to:  </li>
</ol>
<pre><code>The authenticity of host 'pi.hole (192.168.0.4)' can't be established.
ED25519 key fingerprint is SHA256:jWxxjslC9ObhMty4d0UNERghKP6UWmetfEj80CKW6QY.
This host key is known by the following other names/addresses:
    ~/.ssh/known_hosts:8: 192.168.0.4
Are you sure you want to continue connecting (yes/no/[fingerprint])?
</code></pre>
<p>this is likely because you have not connected to the PiHole VM using SSH previously. Verify the IP address is 192.168.0.4 and if it’s correct, type ‘yes’ at the prompt. </p>
<ol>
<li>
<p>At the prompt <code>pihole@pi.hole's password:</code> enter the PiHole user password. Once successfully connected, you should see a prompt similar to <code>pihole@pihole:~$</code>. You are now SSHed into the PiHole VM!</p>
</li>
<li>
<p>Run command <code>pihole -up</code>   </p>
</li>
<li>If prompted <code>[sudo] password for pihole:</code>  enter the PiHole user password  </li>
<li>Wait for it to update. On success, you should see   <code>[✓] Everything is up to date!</code></li>
</ol>
<p>It’s also a good idea to update the underlying Ubuntu instance periodically, especially if there is a notice then you logged into the Pihole VM similar to: </p>
<pre><code>91 updates can be applied immediately.
9 of these updates are standard security updates.
</code></pre>
<p>To do this:</p>
<ol>
<li>Run <code>sudo apt upgrade</code></li>
<li>You may be prompted:</li>
</ol>
<pre><code>After this operation, 430 MB of additional disk space will be used.`
Do you want to continue? [Y/n]
</code></pre>
<p>Enter ‘y’</p>
<ol>
<li>Wait for it to update. This may take a while, depending on the number of updates.</li>
</ol>
<h3 id="via-apple-remote-desktop">Via Apple Remote Desktop</h3>
<ol>
<li>Open Apple Remote Desktop</li>
<li>Select <code>MacServer</code> from All Computers</li>
<li>Click on <code>Control</code> or from the taskbar, or choose <code>Interact &gt; Control</code> </li>
<li>A new window will open with the MacServer display. </li>
<li>From the Dock, Applications Folder or Spotlight, open <code>VirtualBox</code></li>
<li>Ensure <code>Pihole</code> is selected in the sidebar <img alt="virtualbox-pihole-running.png" src="../../img/virtualbox/virtualbox-pihole-running.png" style="height:40px;width:200px" /></li>
<li>Click <code>Show</code> <img alt="virtualbox-pihole-running.png" src="../../img/virtualbox/virtualbox-show.png" style="height:40px;width:40px" /></li>
<li>A new window will open with the PiHole VM. </li>
<li>In that new window, ensure you have a <code>pihole@pihole:~$</code> prompt. If you do not, press enter a few times to get to a new line. </li>
<li>Run command <code>pihole -up</code></li>
<li>If prompted <code>[sudo] password for pihole:</code>  enter the PiHole user password</li>
<li>Wait for it to update. On success, you should see   <code>[✓] Everything is up to date!</code></li>
</ol>
<p>It’s also a good idea to update the underlying Ubuntu instance periodically, especially if there is a notice then you logged into the Pihole VM similar to: </p>
<pre><code>91 updates can be applied immediately.
9 of these updates are standard security updates.
</code></pre>
<p>To do this:</p>
<ol>
<li>Run <code>sudo apt upgrade</code></li>
<li>You may be prompted:</li>
</ol>
<pre><code>After this operation, 430 MB of additional disk space will be used.`
Do you want to continue? [Y/n]
</code></pre>
<p>Enter ‘y’</p>
<ol>
<li>Wait for it to update. This may take a while, depending on the number of updates.</li>
</ol>
              
            </div>
          </div><footer>
    <div class="rst-footer-buttons" role="navigation" aria-label="Footer Navigation">
        <a href="../node-red/" class="btn btn-neutral float-left" title="Node-RED"><span class="icon icon-circle-arrow-left"></span> Previous</a>
        <a href="../../troubleshooting/reboot/" class="btn btn-neutral float-right" title="Reboot">Next <span class="icon icon-circle-arrow-right"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <!-- Copyright etc -->
  </div>

  Built with <a href="https://www.mkdocs.org/">MkDocs</a> using a <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.
</footer>
          
        </div>
      </div>

    </section>

  </div>

  <div class="rst-versions" role="note" aria-label="Versions">
  <span class="rst-current-version" data-toggle="rst-current-version">
    
    
      <span><a href="../node-red/" style="color: #fcfcfc">&laquo; Previous</a></span>
    
    
      <span><a href="../../troubleshooting/reboot/" style="color: #fcfcfc">Next &raquo;</a></span>
    
  </span>
</div>
    <script>var base_url = '../..';</script>
    <script src="../../js/theme_extra.js" defer></script>
    <script src="../../js/theme.js" defer></script>
      <script src="../../search/main.js" defer></script>
    <script defer>
        window.onload = function () {
            SphinxRtdTheme.Navigation.enable(true);
        };
    </script>

</body>
</html>
